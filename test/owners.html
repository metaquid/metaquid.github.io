<html>
  <head>
    <!-- Moralis SDK code -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@3.0.0/dist/web3.min.js"></script>
    <script src="https://unpkg.com/moralis/dist/moralis.js"></script>
    <!-- cell SDK code -->
    <script src="https://unpkg.com/c0js/dist/c0.js"></script>
    <script src="https://testnet.factoria.app/f0/token_abi.js"></script>
     <!-- ipfs code -->
    <script src="https://unpkg.com/ipfsh@0.0.2/dist/ipfsh.min.js"></script>
    
    <script>

    const equals = (a, b) => a.length === b.length && a.every((v, i) => v === b[i]);

    function ownerof() {
      var web3 = new Web3(window.ethereum);
      document.querySelector("form").addEventListener("submit", async (e) => {
        e.preventDefault()
        e.stopPropagation()
        let collection = new web3.eth.Contract([{
          "inputs": [{
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }],
          "name": "ownerOf",
          "outputs": [{
            "internalType": "address",
            "name": "",
            "type": "address"
          }],
          "stateMutability": "view",
          "type": "function"
        }], document.querySelector("#address").value);
        let snapshot = []
        let start = parseInt(document.querySelector("#start").value)
        let end = parseInt(document.querySelector("#end").value)
        if(start < end) {
          for(let i=start; i<=end; i++) {
            try {
              let owner = await collection.methods.ownerOf(i).call()
              snapshot.push(owner)
              console.log(owner)
              document.querySelector("#progress").innerHTML = i;
            } catch (e) {
              console.log(e)
              document.querySelector("#progress").innerHTML = "* non-computable collection !"
              break
            }
          }
        } else {
          for(let i=start; i>=end; i--) {
            try {
              let owner = await collection.methods.ownerOf(i).call()
              snapshot.push(owner)
              console.log(owner)
              document.querySelector("#progress").innerHTML = i;
            } catch (e) {
              console.log(e)
              document.querySelector("#progress").innerHTML = "* non-computable collection !"
              break
            }
          }
        }
        // at least one of the options must be selected
        if(!document.getElementById('okfull').checked && !document.getElementById('okdedup').checked) {
          document.getElementById("okdedup").checked = true
        }
        // 
        if(document.getElementById('okfull').checked) {
          fullwallets = "number of owners " + snapshot.length + "\n" + snapshot.join("\n")
          document.querySelector("#full").innerHTML = fullwallets
        } else {
          document.querySelector("#full").innerHTML = ""
        }
        // 
        if(document.getElementById('okdedup').checked) {
          dedupArr = Array.from(new Set(snapshot))
          if(equals(snapshot, dedupArr)){
            // 
            if(document.getElementById('okfull').checked) {
              document.querySelector("#dedup").innerHTML = "the same list"
            } else {
              dedupwallets = "number of owners " + dedupArr.length + "\n" + dedupArr.join("\n")
              document.querySelector("#dedup").innerHTML = dedupwallets
            }
          } else {
            dedupwallets = "number of owners " + dedupArr.length + "\n" + dedupArr.join("\n")
            document.querySelector("#dedup").innerHTML = dedupwallets
          }
        } else {
          document.querySelector("#dedup").innerHTML = ""
        }
        //
        if(document.getElementById('okint').checked){
          let intersection = snapshot.filter(x => dedupArr.includes(x));
          if(equals(snapshot, intersection)){
            document.querySelector("#intersection").innerHTML = "the same list"
          } else {
            document.querySelector("#intersection").innerHTML = intersection.join("\n")
          }
        }
        //
        if(document.getElementById('okdif').checked){
          let difference = snapshot.filter(x => !dedupArr.includes(x));
          document.querySelector("#difference").innerHTML = difference.join("\n")
        }
      })
    }

    </script>

    <link rel="stylesheet" href="./nft-tools.css">

  </head>
  <body>
    
    <a href="./index.html" class="myButton">█ █ █ █ █ █ █ █ █ █ █ █ █ █ █ █ █ █ █ █ █ █</a>
    <h1>██ NFT-tools ██ </h1>
    <h3> collection of tools for NFT ecosystem </h3>
    <br>

    <a href="./transfer.html" class="myButton">TRANSFER</a>
    <a href="./owners.html" class="myButton">OWNERS</a>
    <a href="./server.html" class="myButton">SERVER</a>

    <h2>NFT holders for a contract address with incremental tokenIds</h2>
    "Bored Ape Yacht Club": 0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D<br>
    "CryptoPunks": 0xb47e3cd837dDF8e4c57F05d70Ab865de6e193BBB<br>
    "Meebits": 0x7Bd29408f11D2bFC23c34f18275bBf23bB716Bc7<br>
    NOTE: "CryptoPunks" have not similar incremental tokenIDs<br>
    <nav>
      <a class='logo' href="/">ownerof A</a>
      <form>
      <input id='address' type='text' maxlength="50" size="42" placeholder='enter contract address'>
      <input id='start' type='text' maxlength="5" size="5" placeholder='start'>
      <input id='end' type='text' maxlength="5" size="5" placeholder='end'>
      <input type='submit' value='snapshot'>
      </form>
    </nav>
    <nav>
      <a class='logo' href="/">ownerof B</a>
      <form>
      <input id='address' type='text' maxlength="50" size="42" placeholder='enter contract address'>
      <input id='start' type='text' maxlength="5" size="5" placeholder='start'>
      <input id='end' type='text' maxlength="5" size="5" placeholder='end'>
      <input type='submit' value='snapshot'>
      </form>
    </nav>
    <br/>
    <div class='f'></div>
    <div class='container'>
      <h3>progressive number A</h3>
      <div id='progress'></div>
      <h3>
        <input type="checkbox" id="okfull" name="okfull" value="full wallets">
        full wallets A
      </h3>
      <pre id='full'></pre>
      <h3>
        <input type="checkbox" id="okdedup" name="okdedup" value="deduplicated wallets">
        deduplicated wallets A
      </h3>
      <pre id='dedup'></pre>
      <h3>
        <input type="checkbox" id="okint" name="okint" value="intersected wallets">
        intersected wallets A
      </h3>
      <pre id='intersection'></pre>
      <h3>
        <input type="checkbox" id="okdif" name="okdif" value="difference wallets">
        difference wallets A
      </h3>
      <pre id='difference'></pre>
    </div>
    
    <script>ownerof()</script>
    
    

  </body>
</html>
